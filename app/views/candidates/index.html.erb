<div align="right" ><%= link_to image_tag('adduser.png'), new_candidate_path, :class=>"dropt", :title=>"add new candidate"   %></div>

<h1>Candidates</h1>

<form class="filter_form">

  <table  cellpadding="1" width="100%"  class="filter_table"   >
    <tr>
      <th>Name:</th>
      <th>Email:</th>
      <th>Phone:</th>
      <th>Skills:</th>
      <th>Status:</th>
    </tr>
    <tr>
      <td align="right" ><%= text_field_tag "search[name]" , params[:search]? params[:search]["name"]:"", :class => "text_box1" %></td>
      <td align="right" ><%= text_field_tag "search[email]" ,params[:search]? params[:search]["email"]:"", :class => "text_box1" %></td>
      <td align="right" ><%= text_field_tag "search[phone]" ,params[:search]? params[:search]["phone"]:"", :class => "text_box1"  %></td>
      <td align="right" ><%= text_field_tag "search[skill]" ,params[:search]? params[:search]["skill"]:"", :class => "text_box1" %></td>
      <td align="right" ><%= select("search[status]" ,"type", ["Exam Scheduled","Exam not Scheduled","Exam Completed"], { :include_blank => true,:selected =>params[:search]?params[:search]["status"][:type]:""},onchange: "this.form.submit();") %></td>
      <td title="search" ><%=image_submit_tag 'filter.png' , :class => 'search' %></td>
    </tr>
  </table>

</form>
<% if @candidates.empty? %>
    <h2>No results..</h2>
<% else %>
    <table   class="index_table" >
      <tr>
        <th>name</th>
        <th>email id</th>
        <th>phone</th>
        <th>skills</th>
        <th>Scheduled?</th>
        <th>Exam Status</th>
        <th></th>

        <% if my_roles.include?('Schedule')   %>
            <th></th>
        <% end %>
      </tr>

      <% @candidates.each do |candidate| %>
          <tr>
            <td width="15%" class="lft"  ><%= candidate.name %></td>
            <td width="20%" class="lft"><%= candidate.user.user_email  %></td>
            <td width="10%" class="lft"><%= candidate.phone1 %></td>
            <td width="20%" class="lft"><%= candidate.skills%></td>

            <td width="15%" class="dropt" title="schedule a test"  >
              <% if candidate.schedule.nil?  %>
                  <%= link_to  'Schedule Now', '#',:remote=>true,:onclick=>"schedule_now(#{candidate.id});" %>
              <% elsif candidate.recruitment_test.nil? %>
                  <% if candidate.schedule.candidates.count<2 %>
                      <%=link_to candidate.schedule.sh_date.strftime("%b %d %A,%Y at %I:%M%p"), '#',:remote=>true,:onclick=>"schedule_now(#{candidate.id});" %>
                  <% else %>
                      <%=link_to candidate.schedule.sh_date.strftime("%b %d %A,%Y at %I:%M%p"), edit_schedule_path(candidate.schedule.id) %>
                  <% end %>
              <% elsif candidate.recruitment_test %>
                  <%=candidate.schedule.sh_date.strftime("%b %d %A,%Y at %I:%M%p")%>
              <% end %>

              <div id=<%= candidate.id%>  style="display: none;" >
              <%= render 'schedule', :candidate => candidate  %>
              </div>

            </td>
            <% if !candidate.recruitment_test.nil?%>
                <td width="10%"><%="Completed"%></td>
            <% elsif !candidate.schedule.nil?&&candidate.schedule.created_at==candidate.schedule.updated_at%>
                <td width="10%">
                  <%="Scheduled"%>
                  <%= link_to image_tag('resent.png'), resent_schedule_email_candidate_path(candidate,status: "schedule"), title: "Resent re-schedule email" %>
                </td>
            <% elsif !candidate.schedule.nil?%>
                <td width="10%">
                  <%="Re Scheduled"%>
                  <%= link_to image_tag('resent.png'), resent_schedule_email_candidate_path(candidate,status: "re-schedule"), title: "Resent schedule email" %>
                </td>
            <% else %>
                <td width="10%"><%= "Cancelled/Not scheduled" %></td>
            <% end %>
            <td width="5%" class="dropt" title="edit"  ><%= link_to image_tag('edit.png'), edit_candidate_path(candidate) %></td>
            <td width="5%" class="dropt" title="delete"  ><%= link_to  image_tag('delete.png'), candidate, method: :delete, data: { confirm: 'Are you sure?' } %></td>

          </tr>
      <% end %>
    </table>
    <h4><%= will_paginate @candidates ,:container=>false %></h4>
<% end %>